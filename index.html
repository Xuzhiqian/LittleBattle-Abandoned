<!DOCTYPE html>
<html>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<head>

    <title>Little Battle</title>
    <link href="index.css" media="screen" rel="stylesheet" type="text/css">

    <script src="/socket.io/socket.io.js"></script>
    <script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
    <script src="lib/keyboard.js"></script>
    <script src="quisus.js"></script>
</head>

<body>
  <audio id="aud_main" autoplay="autoplay" loop src="audio/main.mp3"></audio>
  <script>document.getElementById("aud_main").volume = 0.25;</script>

  <audio id="reward1" perload="auto" src="audio/reward/1.mp3"></audio>
  <audio id="reward2" perload="auto" src="audio/reward/2.mp3"></audio>
  <audio id="reward3" perload="auto" src="audio/reward/3.mp3"></audio>
  <audio id="reward4" perload="auto" src="audio/reward/4.mp3"></audio>
  <audio id="reward5" perload="auto" src="audio/reward/5.mp3"></audio>
  <audio id="reward6" perload="auto" src="audio/reward/6.mp3"></audio>
  <audio id="reward7" perload="auto" src="audio/reward/7.mp3"></audio>
  <audio id="reward8" perload="auto" src="audio/reward/8.mp3"></audio>
  <audio id="reward9" perload="auto" src="audio/reward/9.mp3"></audio>
  <audio id="reward10" perload="auto" src="audio/reward/10.mp3"></audio>
  <audio id="reward11" perload="auto" src="audio/reward/11.mp3"></audio>
  <audio id="kill1" preload="auto" src="audio/kill/1.mp3"></audio>
  <audio id="kill2" preload="auto" src="audio/kill/2.mp3"></audio>
  <audio id="kill3" preload="auto" src="audio/kill/3.mp3"></audio>
  <audio id="kill4" preload="auto" src="audio/kill/4.mp3"></audio>
  <audio id="kill5" preload="auto" src="audio/kill/5.mp3"></audio>
  <audio id="kill6" preload="auto" src="audio/kill/6.mp3"></audio>
  <audio id="kill7" preload="auto" src="audio/kill/7.mp3"></audio>
  <audio id="kill8" preload="auto" src="audio/kill/8.mp3"></audio>
  <audio id="kill9" preload="auto" src="audio/kill/9.mp3"></audio>
  <audio id="attack1" preload="auto" src="audio/attack/1.mp3"></audio>
  <audio id="attack2" preload="auto" src="audio/attack/2.mp3"></audio>
  <audio id="attack3" preload="auto" src="audio/attack/3.mp3"></audio>
  <audio id="attack4" preload="auto" src="audio/attack/4.mp3"></audio>
  <audio id="attack5" preload="auto" src="audio/attack/3.mp3"></audio>
  <audio id="attack6" preload="auto" src="audio/attack/4.mp3"></audio>
  <audio id="underattack1" preload="auto" src="audio/underattack/1.mp3"></audio>
  <audio id="underattack2" preload="auto" src="audio/underattack/2.mp3"></audio>
  <audio id="underattack3" preload="auto" src="audio/underattack/3.mp3"></audio>
  <audio id="underattack4" preload="auto" src="audio/underattack/4.mp3"></audio>

  <audio id="audio_UMP9" preload="auto" src="audio/weapon/UMP9.mp3"></audio>
  <audio id="audio_Micro_Uzi" preload="auto" src="audio/weapon/Micro_Uzi.mp3"></audio>
  <audio id="audio_Vector" preload="auto" src="audio/weapon/Vector.mp3"></audio>
  <audio id="audio_AKM" preload="auto" src="audio/weapon/AKM.mp3"></audio>
  <audio id="audio_Groza" preload="auto" src="audio/weapon/Groza.mp3"></audio>
  <audio id="audio_M16A4" preload="auto" src="audio/weapon/M16A4.mp3"></audio>
  <audio id="audio_Scar-L" preload="auto" src="audio/weapon/Scar-L.mp3"></audio>
  <audio id="audio_M416" preload="auto" src="audio/weapon/M416.mp3"></audio>
  <audio id="audio_Kar-98K" preload="auto" src="audio/weapon/Kar-98K.mp3"></audio>
  <audio id="audio_M24" preload="auto" src="audio/weapon/M24.mp3"></audio>
  <audio id="audio_SKS" preload="auto" src="audio/weapon/SKS.mp3"></audio>
  <audio id="audio_AWM" preload="auto" src="audio/weapon/AWM.mp3"></audio>
  <audio id="audio_MK14" preload="auto" src="audio/weapon/MK14.mp3"></audio>
  <audio id="audio_M249" preload="auto" src="audio/weapon/M249.mp3"></audio>
  <audio id="audio_Minigun" preload="auto" src="audio/weapon/Minigun.mp3"></audio>
  <audio id="audio_Dominator-77" preload="auto" src="audio/weapon/Dominator-77.mp3"></audio>
  <audio id="audio_PF-89" preload="auto" src="audio/weapon/PF-89.mp3"></audio>
  <audio id="audio_S1897" preload="auto" src="audio/weapon/S1897.mp3"></audio>
  <audio id="audio_S686" preload="auto" src="audio/weapon/S686.mp3"></audio>
  <audio id="audio_Pan" preload="auto" src="audio/weapon/Pan.mp3"></audio>
  <audio id="audio_Seeker" preload="auto" src="audio/weapon/Seeker.mp3"></audio>
  
  <img id="UMP9" src="img/UMP9.png" style="display:none;"/>
  <img id="Micro_Uzi" src="img/Micro_Uzi.png" style="display:none;"/>
  <img id="Vector" src="img/Vector.png" style="display:none;"/>
  <img id="AKM" src="img/AKM.png" style="display:none;"/>
  <img id="Groza" src="img/Groza.png" style="display:none;"/>
  <img id="M16A4" src="img/M16A4.png" style="display:none;"/>
  <img id="Scar-L" src="img/Scar-L.png" style="display:none;"/>
  <img id="M416" src="img/M416.png" style="display:none;"/>
  <img id="Kar-98K" src="img/Kar-98K.png" style="display:none;"/>
  <img id="M24" src="img/M24.png" style="display:none;"/>
  <img id="SKS" src="img/SKS.png" style="display:none;"/>
  <img id="AWM" src="img/AWM.png" style="display:none;"/>
  <img id="MK14" src="img/MK14.png" style="display:none;"/>
  <img id="M249" src="img/M249.png" style="display:none;"/>
  <img id="Minigun" src="img/Minigun.png" style="display:none;"/>
  <img id="Dominator-77" src="img/Dominator-77.png" style="display:none;"/>
  <img id="PF-89" src="img/PF-89.png" style="display:none;"/>
  <img id="S1897" src="img/S1897.png" style="display:none;"/>
  <img id="S686" src="img/S686.png" style="display:none;"/>
  <img id="Pan" src="img/Pan.png" style="display:none;"/>
  <img id="Grenade" src="img/Grenade.png" style="display:none;"/>
  <img id="DeathGrenade" src="img/DeathGrenade.png" style="display:none;"/>
  <img id="Seeker" src="img/Seeker.png" style="display:none;"/>
  
<center>
<div id="login">
    <i1 style="font-size:50px;color:lightblue;">Playful Blue-Moon</i1></br></br>
    <div>
      Alias: <input type="text" id="clientNameText">
      <button id="loginBtn">Connect</button>
    </div></br></br>
    <i2 style="font-size:20px;">Use WASD to move and mouse to shoot</br>
      Shoot down boxes to gain supply</br>
      Press F to pickup/drop weapon</br>
      Press M to close/open minimap</br>
      Build your own skill tree
    </i2>
</div>
</center>
<div id="game" class="hidden-div">
    <canvas id="map"></canvas>
</div>
<script>
  (function () {
    function fixViewport(type, designWidth) {
        var metaEl = document.querySelector('meta[name="viewport"]');
        //由于初始设置了viewport的width=device-width,所以此处docEl.clientWidth即是屏幕的设备宽度
        var clientWidth = document.documentElement.clientWidth;
        var width, scale;

        switch (type) {
            case 'fixed':
                width = designWidth;
                scale = clientWidth / designWidth;
                break;
            case 'rem':
                var dpr = window.devicePixelRatio || 1;
                width = clientWidth * dpr;
                scale = 1 / dpr;
                document.documentElement.style.fontSize = 100 * (clientWidth * dpr / designWidth) + "px";
                break;
        }
        metaEl.setAttribute('content', 'width=' + width + ',initial-scale=' + scale + ',maximum-scale=' + scale +
            ',minimum-scale=' + scale);

        //设置body的基准字体大小
        document.body.style.fontSize = 50 / scale + 'px';
    }
    fixViewport('fixed', 800);
}());

</script>

<script src="core.js"></script>
<script src="client.js"></script>
<script>
	$("#loginBtn").click(function () {

		var nickname = String(($("#clientNameText").val()) || 'unknown');
		if (nickname.indexOf('#')!=-1) {alert("No '#' in your nickname!"); return;}

		core = new Q.client_core();
		var socket = io.connect();
		socket.emit('id_checkdup',nickname);

		core.bind('verified',(function(newname){
			$("#login").addClass("hidden-div");
			$("#game").removeClass("hidden-div");
			var enviroment = {
				socket: socket,
				keyboard: new THREEx.KeyboardState(),
				map: document.getElementById('map'),
				ctx: map.getContext('2d')
			}
			enviroment.socket.client_id = newname;
			core.client_initialize(enviroment);
		}).bind(this));

		socket.on('verified',(id)=>{core.trigger('verified',id);});
    socket.on('onfinal',()=>{alert('Game is on final round now, please connect again later.')});
	});
</script>


</body>
</html>